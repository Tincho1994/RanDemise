<html>
<head>
	<title> RanDemise - Random Table Toolkit</title>

	<!-- ~~~~~~~ CSS ~~~~~~~ -->

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<!-- Custom CSS --> 
	<link href="css/wonderful.css" rel="stylesheet">

	<!-- ~~~~ Javascript ~~~~ -->

	<!-- Latest compiled and minified Javascript -->
	<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<!-- Custom Javascript -->
	<script src="js/src.js" type="text/javascript"></script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- ~~~ OTHER STUFF ~~~-->

	<!-- Fonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

	<!-- Icon that appears in the tab - should probably be replaced with a better one --> 
	<link rel="icon" type="image/ico" href="img/favicon.ico">

	<!-- Monster Page Setup -->

    <link rel="import" href="src/top-stats.html">
    <link rel="import" href="src/creature-heading.html">
    <link rel="import" href="src/abilities-block.html">
    <link rel="import" href="src/property-line.html">
    <link rel="import" href="src/property-block.html">
    <link rel="import" href="src/stat-block.html">

    <style>
      body {
        margin: 0;
      }

      stat-block {
        /* A bit of margin for presentation purposes, to show off the drop
        shadow. */
        margin-left: 20px;
        margin-top: 20px;
      }
    </style> 
</head>

<body>

<div class="container" id = "cont">
<div class="page-header">
	<h1>RanDemise - Monster Manual</h1>
</div>

<div class="ui-widget">
  <label for="tags">Monster: </label>
  <input id="tags">
</div>

  <stat-block data-two-column data-content-height="672">
    <creature-heading>
      <h1 id="mName"></h1> 
      <h2 id="mDescription"></h2>
    </creature-heading>

    <top-stats>
      <property-line>
        <h4>Armor Class</h4>
        <p id="mAC"></p>
      </property-line>
      <property-line>
        <h4>Hit Points</h4>
        <p id=mHP></p>
      </property-line>
      <property-line>
        <h4>Speed</h4>
        <p id="mSpeed"></p>
      </property-line>

      <tapered-rule id="abilitiesTopLine"></tapered-rule>

      <abilities-block data-str=""
                       data-dex=""
                       data-con=""
                       data-int=""
                       data-wis=""
                       data-cha=""></abilities-block>
      <property-line>
        <h4 id="mThrowsTitle">Saving Throws</h4>
        <p id="mThrows"></p>
      </property-line>
      <property-line>
        <h4 id="mSkillsTitle">Skills</h4>
        <p id="mSkills"></p>
      </property-line>
      <property-line>
        <h4 id="mVulnerabiltiesTitle">Damage Vulnerabilities</h4>
        <p id="mVulnerabilties"></p>
      </property-line>
      <property-line>
        <h4 id="mResistancesTitle">Damage Resistances</h4>
        <p id="mResistances"></p>
      </property-line>
      <property-line>
        <h4 id="mImmunitiesTitle">Damage Immunities</h4>
        <p id="mImmunities"></p>
      </property-line>
      <property-line>
        <h4 id="mConditionImmunitiesTitle">Condition Immunities</h4>
        <p id="mConditionImmunities"></p>
      </property-line>
      <property-line>
        <h4 id="mSensesTitle">Senses</h4>
        <p id="mSenses"></p>
      </property-line>
      <property-line>
        <h4 id="mLanguagesTitle">Languages</h4>
        <p id="mLanguages"></p>
      </property-line>
      <property-line>
        <h4 id="mChallengeTitle">Challenge</h4>
        <p id="mChallenge"></p>
      </property-line>
    </top-stats>

    <h3>Special Abilities</h3>

    <property-block>
      <h4>Legendary Resistance (3/Day).</h4>
      <p>If the werewolf fails a saving throw, it can choose to succeed
        instead.</p>
    </property-block>

    <property-block>
      <h4>Keen Hearing and Smell.</h4>
      <p>The werewolf has advantage on Wisdom (Perception) checks that rely on
        hearing or smell.</p>
    </property-block>

    <property-block>
      <h4>Pack Leader.</h4>
      <p>The werewolf's allies have advantage on melee attack rolls against
        any hostile creature within 5 feet of the werewolf.</p>
    </property-block>

    <property-block>
      <h4>Shapechanger.</h4>
      <p>The werewolf can use its action to polymorph into a wolf-humanoid
        hybrid or into a wolf, or back into its true form, which is humanoid.
        Its statistics, other than its AC, are the same in each form. Any
        equipment it is wearing or carrying isn't transformed. It reverts to
        its true form if it dies.</p>
    </property-block>
    <h3>Actions</h3>

    <property-block>
      <h4>Multiattack (Hybrid Form Only).</h4>
      <p>The werewolf makes three attacks: one with its bite and two with its
        claws.</p>
    </property-block>

    <property-block>
      <h4>Bite (Wolf or Hybrid Form Only).</h4>
      <p><i>Melee Weapon Attack:</i> +9 to hit, reach 5 ft., one target.
        <i>Hit:</i> 14 (2d8 + 5) piercing damage. If the target is a humanoid,
        it must succeed on a DC 14 Constitution saving throw or be cursed with
        werewolf lycanthropy.</p>
    </property-block>

    <property-block>
      <h4>Claws (Hybrid Form Only).</h4>
      <p><i>Melee Weapon Attack:</i> +9 to hit, reach 5 ft., one target.
        <i>Hit:</i> 16 (2d10 + 5) slashing damage.</p>
    </property-block>

    <h3>Legendary Actions</h3>
    <p>The werewolf can take 3 legendary actions, choosing from the
    options below. Only one legendary action option can be used at a
    time and only at the end of another creature's turn. The werewolf
    regains spent legendary actions at the start of its turn.</p>

    <property-line>
      <h4>Leap.</h4>
      <p>The werewolf moves up to its speed without provoking
        opportunity attacks.</p>
    </property-line>

    <property-line>
      <h4>Bark Orders.</h4>
      <p>The werewolf chooses a friendly creature who can
        see or hear it. That creature can use its reaction to move up to its
        speed without provoking opportunity attacks.</p>
    </property-line>

    <property-line>
      <h4>Frenzy (Costs 2 Actions).</h4>
      <p>The werewolf can make one claw attack against each creature within 5
        feet of it.</p>
    </property-line>
  </stat-block>

  <script type="text/javascript">

  	function loadJSON(callback) {

	    var xobj = new XMLHttpRequest();
	    xobj.overrideMimeType("application/json");
	    xobj.open('GET', 'data/5eMonsters.json', true);
	    xobj.onreadystatechange = function() {
	        if (xobj.readyState == 4 && xobj.status == "200") {

	            // .open will NOT return a value but simply returns undefined in async mode so use a callback
	            callback(xobj.responseText);

	        }
	    }
	    xobj.send(null);

	}

	// Call to function with anonymous callback
	loadJSON(function(response) {
	    var monsters = JSON.parse(response);

	    function get(nme) {
		    for(var i = 0; i < monsters.length; i++) {
		        if(monsters[i].name == nme) {
		            return monsters[i];
		        }
		    }
		};

    var monsterNames = monsters.map(function(d) { return d.name; });

    var characteristics = ["Str", "Dex", "Con", "Int", "Wis", "Cha"]
    var possibleSave = ["strength_save", "dexterity_save", "constitution_save", "intelligence_save", "wisdom_save", "charisma_save"];
    var skills = ["acrobatics", "arcana", "athletics", "deception", "history", "insight", "intimidation", "investigation", "nature", "perception", "performance", "persuasion", "religion", "stealth", "survival"]
    var skillsPrint = ["Acrobatics", "Arcana", "Athletics", "Deception", "History", "Insight", "Intimidation", "Investigation", "Nature", "Perception", "Performance", "Persuasion", "Religion", "Stealth", "Survival"]

    $( function() {
      var availableTags = monsterNames;
      $( "#tags" ).autocomplete({
        source: availableTags,
        select: function(e, ui) {

          var monsterName = ui.item.label;
          var mon = get(monsterName);

          // ---------- Title ----------
          document.getElementById("mName").innerHTML = mon.name;
          document.getElementById("mDescription").innerHTML = mon.size + " " + mon.type + " "  + mon.subtype + ", "  + mon.alignment;

          document.getElementById("mAC").innerHTML = mon.armor_class;
          document.getElementById("mHP").innerHTML = mon.hit_points + " (" + mon.hit_dice + ")";
          document.getElementById("mSpeed").innerHTML = mon.speed;

          // ---------- Skills ----------

          // ---------- Properties ----------
          var savingThrows = "";
          for (var i = 0; i < possibleSave.length; i++) {
            if (mon.hasOwnProperty(possibleSave[i])){
              var prop = possibleSave[i];
              savingThrows = savingThrows.concat(characteristics[i])
              savingThrows = savingThrows.concat(" +")
              savingThrows = savingThrows.concat(mon[prop]);
              savingThrows = savingThrows.concat(" ")
            }
          }
          if ( savingThrows == "" ) {
            document.getElementById("mThrowsTitle").innerHTML = "";
            document.getElementById("mThrows").innerHTML = ""; 

          } else {
            document.getElementById("mThrowsTitle").innerHTML = "Saving Throws";
            document.getElementById("mThrows").innerHTML = savingThrows;
          }

          var skill = "";
          for (var i = 0; i < skills.length; i++) {
            if (mon.hasOwnProperty(skill[i])){
              var thisSkill = skills[i];
              skill = skill.concat(skillsPrint[i])
              skill = skill.concat(" +")
              skill = skill.concat(mon[thisSkill]);
              skill = skill.concat(" ")
            }
          }
          if ( skill == "" ) {
            document.getElementById("mSkillsTitle").innerHTML = "";
            document.getElementById("mSkills").innerHTML = "";
          } else {
            document.getElementById("mSkillsTitle").innerHTML = "Skills";
            document.getElementById("mSkills").innerHTML = skill;
          }

          if ( mon.damage_vulnerabilities == "" ) {
            document.getElementById("mVulnerabiltiesTitle").innerHTML = "";
            document.getElementById("mVulnerabilties").innerHTML = "";

          } else {
            document.getElementById("mVulnerabiltiesTitle").innerHTML = "Damage Vulnerabilities";
            document.getElementById("mVulnerabilties").innerHTML = mon.damage_vulnerabilities;
          }

          if ( mon.damage_resistances == "" ) {
            document.getElementById("mResistancesTitle").innerHTML = "";
            document.getElementById("mResistances").innerHTML = "";

          } else {
            document.getElementById("mResistancesTitle").innerHTML = "Damage Resistances";
            document.getElementById("mResistances").innerHTML = mon.damage_resistances;
          }

          if ( mon.damage_immunities == "" ) {
            document.getElementById("mImmunitiesTitle").innerHTML = "";
            document.getElementById("mImmunities").innerHTML = "";
          } else {
            document.getElementById("mImmunitiesTitle").innerHTML = "Damage Immunities";
            document.getElementById("mImmunities").innerHTML = mon.damage_immunities;
          }

          if ( mon.condition_immunities == "" ) {
            document.getElementById("mConditionImmunitiesTitle").innerHTML = "";
            document.getElementById("mConditionImmunities").innerHTML = "";
          } else {
            document.getElementById("mConditionImmunitiesTitle").innerHTML = "Condition Immunities";
            document.getElementById("mConditionImmunities").innerHTML = mon.condition_immunities;
          }

          document.getElementById("mSenses").innerHTML = mon.senses;
          document.getElementById("mLanguages").innerHTML = mon.languages;
          document.getElementById("mChallenge").innerHTML = mon.challenge_rating;

          // ---------- Actions ----------

          return true;
        }
      });

    } );

	});

</script>

</body>