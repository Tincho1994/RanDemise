{"version":3,"file":"svg.panzoom.esm.js","sources":["../src/svg.panzoom.js"],"sourcesContent":["import { Svg, on, off, extend, Matrix, Box } from '@svgdotjs/svg.js'\r\n\r\nconst normalizeEvent = ev =>\r\n  ev.touches || [{ clientX: ev.clientX, clientY: ev.clientY }]\r\n\r\nextend(Svg, {\r\n  panZoom (options) {\r\n    this.off('.panZoom')\r\n\r\n    // when called with false, disable panZoom\r\n    if (options === false) return this\r\n\r\n    options = options ?? {}\r\n    const zoomFactor = options.zoomFactor ?? 2\r\n    const zoomMin = options.zoomMin ?? Number.MIN_VALUE\r\n    const zoomMax = options.zoomMax ?? Number.MAX_VALUE\r\n    const doWheelZoom = options.wheelZoom ?? true\r\n    const doPinchZoom = options.pinchZoom ?? true\r\n    const doPanning = options.panning ?? true\r\n    const panButton = options.panButton ?? 0\r\n    const oneFingerPan = options.oneFingerPan ?? false\r\n    const margins = options.margins ?? false\r\n    const wheelZoomDeltaModeLinePixels = options.wheelZoomDeltaModeLinePixels ?? 17\r\n    const wheelZoomDeltaModeScreenPixels = options.wheelZoomDeltaModeScreenPixels ?? 53\r\n\r\n    let lastP\r\n    let lastTouches\r\n    let zoomInProgress = false\r\n\r\n    const restrictToMargins = box => {\r\n      if (!margins) return box\r\n      const { top, left, bottom, right } = margins\r\n      const zoom = this.width() / box.width\r\n\r\n      const { width, height } = this.attr(['width', 'height'])\r\n\r\n      const leftLimit = width - left / zoom\r\n      const rightLimit = (right - width) / zoom\r\n      const topLimit = height - top / zoom\r\n      const bottomLimit = (bottom - height) / zoom\r\n\r\n      box.x = Math.min(leftLimit, Math.max(rightLimit, box.x))\r\n      box.y = Math.min(topLimit, Math.max(bottomLimit, box.y))\r\n      return box\r\n    }\r\n\r\n    const wheelZoom = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      // When wheeling on a mouse,\r\n      // - chrome by default uses deltaY = 53, deltaMode = 0 (pixel)\r\n      // - firefox by default uses deltaY = 3, deltaMode = 1 (line)\r\n      // - chrome and firefox on windows after configuring \"One screen at a time\"\r\n      //   use deltaY = 1, deltaMode = 2 (screen)\r\n      //\r\n      // Note that when when wheeling on a touchpad, deltaY depends on how fast\r\n      // you swipe, but the deltaMode is still different between the browsers.\r\n      //\r\n      // Normalize everything so that zooming speed is approximately the same in all cases\r\n      let normalizedPixelDeltaY\r\n      switch (ev.deltaMode) {\r\n      case 1:\r\n        normalizedPixelDeltaY = ev.deltaY * wheelZoomDeltaModeLinePixels\r\n        break\r\n      case 2:\r\n        normalizedPixelDeltaY = ev.deltaY * wheelZoomDeltaModeScreenPixels\r\n        break\r\n      default:\r\n        // 0 (already pixels) or new mode (avoid crashing)\r\n        normalizedPixelDeltaY = ev.deltaY\r\n        break\r\n      }\r\n\r\n      let lvl = Math.pow(1 + zoomFactor, (-1 * normalizedPixelDeltaY) / 100) * this.zoom()\r\n      const p = this.point(ev.clientX, ev.clientY)\r\n\r\n      if (lvl > zoomMax) {\r\n        lvl = zoomMax\r\n      }\r\n\r\n      if (lvl < zoomMin) {\r\n        lvl = zoomMin\r\n      }\r\n\r\n      if (this.dispatch('zoom', { level: lvl, focus: p }).defaultPrevented) {\r\n        return this\r\n      }\r\n\r\n      this.zoom(lvl, p)\r\n\r\n      if (margins) {\r\n        const box = restrictToMargins(this.viewbox())\r\n        this.viewbox(box)\r\n      }\r\n    }\r\n\r\n    const pinchZoomStart = function (ev) {\r\n      lastTouches = normalizeEvent(ev)\r\n\r\n      // Start panning in case only one touch is found\r\n      if (lastTouches.length < 2) {\r\n        if (doPanning && oneFingerPan) {\r\n          panStart.call(this, ev)\r\n        }\r\n        return\r\n      }\r\n\r\n      // Stop panning for more than one touch\r\n      if (doPanning && oneFingerPan) {\r\n        panStop.call(this, ev)\r\n      }\r\n\r\n      // We call it so late, so the user is still able to scroll / reload the page via gesture\r\n      // In case oneFingerPan is not active\r\n      ev.preventDefault()\r\n\r\n      if (this.dispatch('pinchZoomStart', { event: ev }).defaultPrevented) {\r\n        return\r\n      }\r\n\r\n      this.off('touchstart.panZoom', pinchZoomStart)\r\n\r\n      zoomInProgress = true\r\n      on(document, 'touchmove.panZoom', pinchZoom, this, { passive: false })\r\n      on(document, 'touchend.panZoom', pinchZoomStop, this, { passive: false })\r\n    }\r\n\r\n    const pinchZoomStop = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      const currentTouches = normalizeEvent(ev)\r\n      if (currentTouches.length > 1) {\r\n        return\r\n      }\r\n\r\n      zoomInProgress = false\r\n\r\n      this.dispatch('pinchZoomEnd', { event: ev })\r\n\r\n      off(document, 'touchmove.panZoom', pinchZoom)\r\n      off(document, 'touchend.panZoom', pinchZoomStop)\r\n      this.on('touchstart.panZoom', pinchZoomStart)\r\n\r\n      if (currentTouches.length && doPanning && oneFingerPan) {\r\n        panStart.call(this, ev)\r\n      }\r\n    }\r\n\r\n    const pinchZoom = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      const currentTouches = normalizeEvent(ev)\r\n      const zoom = this.zoom()\r\n\r\n      // Distance Formula\r\n      const lastDelta = Math.sqrt(\r\n        Math.pow(lastTouches[0].clientX - lastTouches[1].clientX, 2) +\r\n          Math.pow(lastTouches[0].clientY - lastTouches[1].clientY, 2)\r\n      )\r\n\r\n      const currentDelta = Math.sqrt(\r\n        Math.pow(currentTouches[0].clientX - currentTouches[1].clientX, 2) +\r\n          Math.pow(currentTouches[0].clientY - currentTouches[1].clientY, 2)\r\n      )\r\n\r\n      let zoomAmount = lastDelta / currentDelta\r\n\r\n      if (\r\n        (zoom < zoomMin && zoomAmount > 1) ||\r\n        (zoom > zoomMax && zoomAmount < 1)\r\n      ) {\r\n        zoomAmount = 1\r\n      }\r\n\r\n      const currentFocus = {\r\n        x:\r\n          currentTouches[0].clientX +\r\n          0.5 * (currentTouches[1].clientX - currentTouches[0].clientX),\r\n        y:\r\n          currentTouches[0].clientY +\r\n          0.5 * (currentTouches[1].clientY - currentTouches[0].clientY)\r\n      }\r\n\r\n      const lastFocus = {\r\n        x:\r\n          lastTouches[0].clientX +\r\n          0.5 * (lastTouches[1].clientX - lastTouches[0].clientX),\r\n        y:\r\n          lastTouches[0].clientY +\r\n          0.5 * (lastTouches[1].clientY - lastTouches[0].clientY)\r\n      }\r\n\r\n      const p = this.point(currentFocus.x, currentFocus.y)\r\n      const focusP = this.point(\r\n        2 * currentFocus.x - lastFocus.x,\r\n        2 * currentFocus.y - lastFocus.y\r\n      )\r\n      const box = new Box(this.viewbox()).transform(\r\n        new Matrix()\r\n          .translate(-focusP.x, -focusP.y)\r\n          .scale(zoomAmount, 0, 0)\r\n          .translate(p.x, p.y)\r\n      )\r\n\r\n      restrictToMargins(box)\r\n      this.viewbox(box)\r\n\r\n      lastTouches = currentTouches\r\n\r\n      this.dispatch('zoom', { box: box, focus: focusP })\r\n    }\r\n\r\n    const panStart = function (ev) {\r\n      const isMouse = ev.type.indexOf('mouse') > -1\r\n\r\n      // In case panStart is called with touch, ev.button is undefined\r\n      if (isMouse && ev.button !== panButton && ev.which !== panButton + 1) {\r\n        return\r\n      }\r\n\r\n      ev.preventDefault()\r\n\r\n      this.off('mousedown.panZoom', panStart)\r\n\r\n      lastTouches = normalizeEvent(ev)\r\n\r\n      if (zoomInProgress) return\r\n\r\n      this.dispatch('panStart', { event: ev })\r\n\r\n      lastP = { x: lastTouches[0].clientX, y: lastTouches[0].clientY }\r\n\r\n      on(document, 'touchmove.panZoom mousemove.panZoom', panning, this, {\r\n        passive: false\r\n      })\r\n\r\n      on(document, 'touchend.panZoom mouseup.panZoom', panStop, this, {\r\n        passive: false\r\n      })\r\n    }\r\n\r\n    const panStop = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      off(document, 'touchmove.panZoom mousemove.panZoom', panning)\r\n      off(document, 'touchend.panZoom mouseup.panZoom', panStop)\r\n      this.on('mousedown.panZoom', panStart)\r\n\r\n      this.dispatch('panEnd', { event: ev })\r\n    }\r\n\r\n    const panning = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      const currentTouches = normalizeEvent(ev)\r\n\r\n      const currentP = {\r\n        x: currentTouches[0].clientX,\r\n        y: currentTouches[0].clientY\r\n      }\r\n\r\n      const p1 = this.point(currentP.x, currentP.y)\r\n\r\n      const p2 = this.point(lastP.x, lastP.y)\r\n\r\n      const deltaP = [p2.x - p1.x, p2.y - p1.y]\r\n\r\n      if (!deltaP[0] && !deltaP[1]) {\r\n        return\r\n      }\r\n\r\n      const box = new Box(this.viewbox()).transform(\r\n        new Matrix().translate(deltaP[0], deltaP[1])\r\n      )\r\n\r\n      lastP = currentP\r\n\r\n      restrictToMargins(box)\r\n\r\n      if (this.dispatch('panning', { box, event: ev }).defaultPrevented) {\r\n        return\r\n      }\r\n\r\n      this.viewbox(box)\r\n    }\r\n\r\n    if (doWheelZoom) {\r\n      this.on('wheel.panZoom', wheelZoom, this, { passive: false })\r\n    }\r\n\r\n    if (doPinchZoom) {\r\n      this.on('touchstart.panZoom', pinchZoomStart, this, { passive: false })\r\n    }\r\n\r\n    if (doPanning) {\r\n      this.on('mousedown.panZoom', panStart, this, { passive: false })\r\n    }\r\n\r\n    return this\r\n  }\r\n})\r\n"],"names":["normalizeEvent","ev","touches","clientX","clientY","extend","Svg","panZoom","options","off","zoomFactor","zoomMin","Number","MIN_VALUE","zoomMax","MAX_VALUE","doWheelZoom","wheelZoom","doPinchZoom","pinchZoom","doPanning","panning","panButton","oneFingerPan","margins","wheelZoomDeltaModeLinePixels","wheelZoomDeltaModeScreenPixels","lastP","lastTouches","zoomInProgress","restrictToMargins","box","top","left","bottom","right","zoom","width","attr","height","leftLimit","rightLimit","topLimit","bottomLimit","x","Math","min","max","y","preventDefault","normalizedPixelDeltaY","deltaMode","deltaY","lvl","pow","p","point","dispatch","level","focus","defaultPrevented","viewbox","pinchZoomStart","length","panStart","call","panStop","event","on","document","passive","pinchZoomStop","currentTouches","lastDelta","sqrt","currentDelta","zoomAmount","currentFocus","lastFocus","focusP","Box","transform","Matrix","translate","scale","isMouse","type","indexOf","button","which","currentP","p1","p2","deltaP"],"mappings":"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"}